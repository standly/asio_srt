# Async Queue å®ç°æ–¹æ¡ˆå¯¹æ¯”

## ğŸ“Š ä¸‰ç§å®ç°æ–¹æ¡ˆçš„å¿«é€Ÿå¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Async Queue å®ç°æ–¹æ¡ˆ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–¹æ¡ˆ1: åŸç‰ˆ async_queueï¼ˆå½“å‰å®ç°ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  push()                  async_read_msg()                    â”‚
â”‚    â”‚                          â”‚                              â”‚
â”‚    â”œâ”€â†’ åŠ å…¥é˜Ÿåˆ—                â”œâ”€â†’ é˜Ÿåˆ—æœ‰æ¶ˆæ¯ï¼Ÿ                â”‚
â”‚    â”‚                          â”‚      â†“ æ˜¯                    â”‚
â”‚    â””â”€â†’ æ£€æŸ¥ pending_handler?   â”‚    è¿”å›æ¶ˆæ¯                  â”‚
â”‚           â†“ æœ‰                â”‚      â†“ å¦                    â”‚
â”‚         è°ƒç”¨ handler           â”‚    ä¿å­˜åˆ° pending_handler    â”‚
â”‚                               â”‚                              â”‚
â”‚  ç‰¹ç‚¹ï¼š                                                        â”‚
â”‚  â€¢ ä»£ç å¤æ‚ï¼ˆ420è¡Œï¼‰                                           â”‚
â”‚  â€¢ æ€§èƒ½æœ€ä¼˜                                                    â”‚
â”‚  â€¢ åªæ”¯æŒ1ä¸ªç­‰å¾…è€…                                             â”‚
â”‚  â€¢ éœ€è¦ç±»å‹æ“¦é™¤                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–¹æ¡ˆ2: ä½¿ç”¨ async_semaphoreï¼ˆæ¨èï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  push()                  async_read_msg()                    â”‚
â”‚    â”‚                          â”‚                              â”‚
â”‚    â”œâ”€â†’ åŠ å…¥é˜Ÿåˆ—                â”œâ”€â†’ semaphore.acquire()        â”‚
â”‚    â”‚                          â”‚      â†“                       â”‚
â”‚    â””â”€â†’ semaphore.release()    â”‚    ä»é˜Ÿåˆ—å–æ¶ˆæ¯               â”‚
â”‚                               â”‚                              â”‚
â”‚  ç‰¹ç‚¹ï¼š                                                        â”‚
â”‚  â€¢ ä»£ç ç®€æ´ï¼ˆ~250è¡Œï¼‰                                          â”‚
â”‚  â€¢ æ€§èƒ½è‰¯å¥½ï¼ˆ-5~10%ï¼‰                                         â”‚
â”‚  â€¢ è‡ªåŠ¨æ”¯æŒå¤šä¸ªç­‰å¾…è€…                                          â”‚
â”‚  â€¢ æ— éœ€ç±»å‹æ“¦é™¤                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–¹æ¡ˆ3: ä½¿ç”¨ async_eventï¼ˆâŒ ä¸æ¨èï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  push()                  async_read_msg()                    â”‚
â”‚    â”‚                          â”‚                              â”‚
â”‚    â”œâ”€â†’ åŠ å…¥é˜Ÿåˆ—                â”œâ”€â†’ event.wait()               â”‚
â”‚    â”‚                          â”‚      â†“                       â”‚
â”‚    â””â”€â†’ event.notify_all()     â”‚    ä»é˜Ÿåˆ—å–æ¶ˆæ¯               â”‚
â”‚           â†“                   â”‚      â†“                       â”‚
â”‚      âŒ å”¤é†’æ‰€æœ‰ç­‰å¾…è€…ï¼        â”‚    âŒ ç«æ€æ¡ä»¶ï¼              â”‚
â”‚                               â”‚                              â”‚
â”‚  ç‰¹ç‚¹ï¼š                                                        â”‚
â”‚  â€¢ è¯­ä¹‰ä¸åŒ¹é…                                                  â”‚
â”‚  â€¢ ä¼šå¯¼è‡´ç«æ€æ¡ä»¶                                              â”‚
â”‚  â€¢ âŒ ä¸é€‚åˆé˜Ÿåˆ—åœºæ™¯                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ è¯¦ç»†å¯¹æ¯”è¡¨

| ç»´åº¦ | åŸç‰ˆ async_queue | Semaphore ç‰ˆ | Event ç‰ˆ |
|------|-----------------|-------------|---------|
| **ä»£ç è¡Œæ•°** | 420 | ~250 (-40%) | âŒ |
| **ç±»å‹æ“¦é™¤** | éœ€è¦ï¼ˆ~20è¡Œï¼‰ | ä¸éœ€è¦ | âŒ |
| **pending_handler** | 1ä¸ª unique_ptr | 0ï¼ˆsemaphoreå†…ç®¡ç†ï¼‰ | âŒ |
| **push å¤æ‚åº¦** | 12è¡Œ | 6è¡Œ (-50%) | âŒ |
| **read å¤æ‚åº¦** | 25è¡Œ | 15è¡Œ (-40%) | âŒ |
| **å¤šç­‰å¾…è€…æ”¯æŒ** | âŒ (åªæ”¯æŒ1ä¸ª) | âœ… (è‡ªåŠ¨) | âœ… (ä½†æœ‰ç«æ€) |
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­â­â­ (-5~10%) | âŒ |
| **å¯ç»´æŠ¤æ€§** | â­â­â­ | â­â­â­â­â­ | âŒ |
| **é€‚ç”¨åœºæ™¯** | æ€§èƒ½æ•æ„Ÿ | ä¸€èˆ¬åœºæ™¯ | âŒ ä¸é€‚åˆé˜Ÿåˆ— |
| **æ¨èåº¦** | â­â­â­â­ | â­â­â­â­â­ | âŒ |

---

## ğŸ¯ æ ¸å¿ƒå·®å¼‚å›¾è§£

### ç­‰å¾…è€…ç®¡ç†æ–¹å¼

```
åŸç‰ˆ async_queue:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ async_queue     â”‚
â”‚                 â”‚
â”‚ pending_handler â”‚ â”€â”€â†’ [ Handler ]  â† åªèƒ½æœ‰1ä¸ª
â”‚  (unique_ptr)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Semaphore ç‰ˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ async_queue_v2  â”‚
â”‚                 â”‚
â”‚ semaphore       â”‚ â”€â”€â†’ [ Handler1 ] â† æ”¯æŒå¤šä¸ª
â”‚                 â”‚     [ Handler2 ]
â”‚                 â”‚     [ Handler3 ]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Event ç‰ˆ (é—®é¢˜):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ async_queue     â”‚
â”‚                 â”‚
â”‚ event           â”‚ â”€â”€â†’ [ Handler1 ] â† notify_all å”¤é†’å…¨éƒ¨
â”‚                 â”‚     [ Handler2 ]    âŒ ç«æ€æ¡ä»¶ï¼
â”‚                 â”‚     [ Handler3 ]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Push æ“ä½œæµç¨‹

```
åŸç‰ˆ:
push(msg) â†’ åŠ å…¥é˜Ÿåˆ— â†’ æ£€æŸ¥ pending_handler? 
                         â”œâ”€ æœ‰ â†’ å–å‡ºæ¶ˆæ¯ â†’ è°ƒç”¨ handler
                         â””â”€ æ—  â†’ ç»“æŸ

Semaphore ç‰ˆ:
push(msg) â†’ åŠ å…¥é˜Ÿåˆ— â†’ semaphore.release() â†’ è‡ªåŠ¨å”¤é†’1ä¸ªç­‰å¾…è€…
                                            â†“
                                         ç­‰å¾…è€…çš„ acquire å®Œæˆ
                                            â†“
                                         ç­‰å¾…è€…ä»é˜Ÿåˆ—å–æ¶ˆæ¯

Event ç‰ˆ:
push(msg) â†’ åŠ å…¥é˜Ÿåˆ— â†’ event.notify_all() â†’ âŒ å”¤é†’æ‰€æœ‰ç­‰å¾…è€…
                                            â†“
                                         âŒ æ‰€æœ‰ç­‰å¾…è€…äº‰æŠ¢1æ¡æ¶ˆæ¯
```

---

## ğŸ’¡ å†³ç­–æ ‘

```
éœ€è¦ä½¿ç”¨ async_queue?
    â”‚
    â”œâ”€ æ€§èƒ½æåº¦æ•æ„Ÿ? (ååé‡ > 100ä¸‡/ç§’)
    â”‚   â””â”€ æ˜¯ â†’ ä½¿ç”¨åŸç‰ˆ async_queue âœ…
    â”‚
    â”œâ”€ éœ€è¦å¤šä¸ªç­‰å¾…è€…?
    â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ Semaphore ç‰ˆ âœ…
    â”‚   â””â”€ å¦ â†’ ä¸¤è€…éƒ½å¯
    â”‚
    â”œâ”€ ä»£ç å¯ç»´æŠ¤æ€§ä¼˜å…ˆ?
    â”‚   â””â”€ æ˜¯ â†’ ä½¿ç”¨ Semaphore ç‰ˆ âœ…
    â”‚
    â”œâ”€ æ–°é¡¹ç›®?
    â”‚   â””â”€ æ˜¯ â†’ ä½¿ç”¨ Semaphore ç‰ˆ âœ…
    â”‚
    â””â”€ å·²æœ‰å¤§é‡ä»£ç ä¾èµ–?
        â””â”€ æ˜¯ â†’ ä¿æŒåŸç‰ˆ âœ…
```

---

## ğŸ”¢ æ€§èƒ½é¢„ä¼°

### ååé‡å¯¹æ¯”ï¼ˆæ¶ˆæ¯/ç§’ï¼‰

```
åœºæ™¯ï¼šå•ç”Ÿäº§è€… + å•æ¶ˆè´¹è€…

åŸç‰ˆ:           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 1,000,000 msg/s (åŸºå‡†)
Semaphoreç‰ˆ:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   900,000 msg/s (-10%)
                                    â†‘ å¯æ¥å—

åœºæ™¯ï¼šå•ç”Ÿäº§è€… + 10æ¶ˆè´¹è€…

åŸç‰ˆ:           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ            ä¸æ”¯æŒï¼ˆåªèƒ½1ä¸ªç­‰å¾…è€…ï¼‰
Semaphoreç‰ˆ:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 1,000,000 msg/s
                                    â†‘ æ›´å¼ºå¤§
```

### å†…å­˜å ç”¨å¯¹æ¯”ï¼ˆæ¯ä¸ªç­‰å¾…è€…ï¼‰

```
åŸç‰ˆ:           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 64 å­—èŠ‚ (handler_impl)
Semaphoreç‰ˆ:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 80 å­—èŠ‚ (handler_impl + semaphore å¼€é”€)
                          â†‘ +25% ä½†ä»ç„¶å¾ˆå°
```

---

## ğŸ“ ä»£ç ç®€åŒ–ç¤ºä¾‹

### Push æ“ä½œå¯¹æ¯”

```cpp
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// åŸç‰ˆï¼ˆ12è¡Œï¼‰
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
void push(T msg) {
    asio::post(strand_, [self, msg = std::move(msg)]() mutable {
        if (self->stopped_) return;
        self->queue_.push_back(std::move(msg));
        
        if (self->pending_handler_) {              // â† éœ€è¦æ‰‹åŠ¨æ£€æŸ¥
            T message = std::move(self->queue_.front());
            self->queue_.pop_front();
            auto handler = std::move(self->pending_handler_);
            handler->invoke(std::error_code{}, std::move(message));
        }
    });
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// Semaphore ç‰ˆï¼ˆ6è¡Œï¼Œ-50%ï¼‰
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
void push(T msg) {
    asio::post(strand_, [self, msg = std::move(msg)]() mutable {
        if (self->stopped_) return;
        self->queue_.push_back(std::move(msg));
        self->semaphore_.release();  // â† å°±è¿™ä¹ˆç®€å•ï¼
    });
}
```

### Read æ“ä½œå¯¹æ¯”

```cpp
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// åŸç‰ˆï¼ˆ25è¡Œï¼‰
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
auto async_read_msg(CompletionToken&& token) {
    return asio::async_initiate<CompletionToken, void(std::error_code, T)>(
        [self](auto handler) mutable {
            asio::post(self->strand_, [self, handler = std::move(handler)]() mutable {
                if (self->stopped_) {
                    // ... é”™è¯¯å¤„ç†
                    return;
                }
                
                if (!self->queue_.empty()) {
                    // æœ‰æ¶ˆæ¯ï¼Œç«‹å³è¿”å›
                    T msg = std::move(self->queue_.front());
                    self->queue_.pop_front();
                    handler(std::error_code{}, std::move(msg));
                } else {
                    // â† æ— æ¶ˆæ¯ï¼Œéœ€è¦ä¿å­˜ handlerï¼ˆéœ€è¦ç±»å‹æ“¦é™¤ï¼‰
                    self->pending_handler_ = std::make_unique<handler_impl<...>>(
                        std::move(handler)
                    );
                }
            });
        },
        token
    );
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// Semaphore ç‰ˆï¼ˆ15è¡Œï¼Œ-40%ï¼‰
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
auto async_read_msg(CompletionToken&& token) {
    return asio::async_initiate<CompletionToken, void(std::error_code, T)>(
        [self](auto handler) mutable {
            // â† é€»è¾‘æ¸…æ™°ï¼šå…ˆ acquireï¼Œå†å–æ¶ˆæ¯
            self->semaphore_.acquire([self, handler = std::move(handler)](auto...) mutable {
                asio::post(self->strand_, [self, handler = std::move(handler)]() mutable {
                    if (self->stopped_ || self->queue_.empty()) {
                        handler(std::make_error_code(std::errc::operation_canceled), T{});
                        return;
                    }
                    T msg = std::move(self->queue_.front());
                    self->queue_.pop_front();
                    handler(std::error_code{}, std::move(msg));
                });
            });
        },
        token
    );
}
```

---

## âœ… æœ€ç»ˆæ¨è

### æ¨èçŸ©é˜µ

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| **æ–°é¡¹ç›®** | Semaphore ç‰ˆ â­â­â­â­â­ | ä»£ç ç®€æ´ï¼Œæ˜“ç»´æŠ¤ |
| **é«˜æ€§èƒ½ç³»ç»Ÿ** | åŸç‰ˆ â­â­â­â­â­ | æ€§èƒ½æœ€ä¼˜ |
| **å¤šæ¶ˆè´¹è€…** | Semaphore ç‰ˆ â­â­â­â­â­ | è‡ªåŠ¨æ”¯æŒå¤šä¸ªç­‰å¾…è€… |
| **å­¦ä¹ /æ•™å­¦** | Semaphore ç‰ˆ â­â­â­â­â­ | é€»è¾‘æ¸…æ™°ï¼Œæ˜“ç†è§£ |
| **ç”Ÿäº§ç¯å¢ƒï¼ˆå·²æœ‰ï¼‰** | åŸç‰ˆ â­â­â­â­ | ç¨³å®šï¼Œæˆç†Ÿ |
| **åŸå‹å¼€å‘** | Semaphore ç‰ˆ â­â­â­â­â­ | å¿«é€Ÿå®ç° |

### å®æ–½å»ºè®®

```cpp
// æ–¹æ¡ˆï¼šä¿æŒä¸¤è€…å¹¶å­˜

namespace bcast {

// åŸç‰ˆï¼šæ€§èƒ½ä¼˜å…ˆ
template<typename T>
class async_queue { ... };  // 420è¡Œï¼Œæ€§èƒ½æœ€ä¼˜

// V2ç‰ˆï¼šå¯ç»´æŠ¤æ€§ä¼˜å…ˆ
template<typename T>
class async_queue_v2 { ... };  // 250è¡Œï¼Œä»£ç ç®€æ´

// ä½¿ç”¨åˆ«åæ–¹ä¾¿åˆ‡æ¢
template<typename T>
using fast_queue = async_queue<T>;      // æ€§èƒ½ä¼˜å…ˆ

template<typename T>
using simple_queue = async_queue_v2<T>; // å¯ç»´æŠ¤æ€§ä¼˜å…ˆ

} // namespace bcast
```

---

## ğŸ“ å­¦ä¹ ä»·å€¼

### ä½¿ç”¨ Semaphore ç‰ˆçš„æ•™è‚²æ„ä¹‰

1. **å­¦ä¹ ä¿¡å·é‡æ¦‚å¿µ**
   ```
   è®¡æ•°ä¿¡å·é‡ = å¯ç”¨èµ„æºæ•°é‡
   acquire() = æ¶ˆè€—èµ„æºï¼ˆç­‰å¾…ï¼‰
   release() = é‡Šæ”¾èµ„æºï¼ˆå”¤é†’ï¼‰
   ```

2. **ç†è§£æŠ½è±¡å±‚æ¬¡**
   ```
   é«˜çº§æŠ½è±¡ï¼ˆSemaphoreï¼‰â†’ ç®€åŒ–å®ç°ï¼ˆQueueï¼‰
   è€Œä¸æ˜¯ï¼š
   åº•å±‚æœºåˆ¶ï¼ˆHandlerç®¡ç†ï¼‰â†’ å¤æ‚å®ç°ï¼ˆQueueï¼‰
   ```

3. **ç»„åˆ vs æ‰‹åŠ¨å®ç°**
   - Semaphore ç‰ˆï¼šç»„åˆå·²æœ‰ç»„ä»¶
   - åŸç‰ˆï¼šä»é›¶å®ç°æ‰€æœ‰æœºåˆ¶
   - æ•™è®­ï¼š**ä¼˜å…ˆç»„åˆï¼Œè€Œéé‡å†™**

---

**æ€»ç»“ä¸€å¥è¯**ï¼š

**ä½¿ç”¨ `async_semaphore` å¯ä»¥å°† `async_queue` çš„ä»£ç å‡å°‘ 40%ï¼ŒåŒæ—¶ä¿æŒ 90% çš„æ€§èƒ½ï¼Œæ˜¯å¤§å¤šæ•°åœºæ™¯çš„æœ€ä½³é€‰æ‹©ã€‚**

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-10-10  
**æ¨è**ï¼šâœ… æ–°é¡¹ç›®ä½¿ç”¨ Semaphore ç‰ˆ


